# 32.5 注释技术


<!-- TOC -->

- [32.5 注释技术](#325-注释技术)
    - [注释的层次：](#注释的层次)
    - [注释单行](#注释单行)
        - [单行注释的指导原则：](#单行注释的指导原则)
            - [不要随意添加无关注释](#不要随意添加无关注释)
        - [行尾注释及其问题：](#行尾注释及其问题)
            - [不要对单行代码做行尾注释](#不要对单行代码做行尾注释)
            - [不要对多行代码做行尾注释](#不要对多行代码做行尾注释)
        - [何时该用行尾注释：](#何时该用行尾注释)
    - [注释代码段](#注释代码段)
        - [注释应表达代码的意图](#注释应表达代码的意图)
        - [代码本身应尽力做好说明](#代码本身应尽力做好说明)
        - [注释代码时，应注重why而不是how](#注释代码时应注重why而不是how)
        - [用注释为后面的内容做铺垫](#用注释为后面的内容做铺垫)
        - [让每个注释都有用](#让每个注释都有用)
        - [说明非常规做法](#说明非常规做法)
        - [别用缩略语](#别用缩略语)
        - [将主次注释区分开](#将主次注释区分开)
        - [错误或语言环境独特点都要加注释](#错误或语言环境独特点都要加注释)
        - [给出违背良好编程风格的理由](#给出违背良好编程风格的理由)
        - [不要注释投机取巧的代码，应重写之。](#不要注释投机取巧的代码应重写之)
    - [注释数据声明](#注释数据声明)
        - [注释数值单位](#注释数值单位)
        - [对数值的允许范围给出注释](#对数值的允许范围给出注释)
        - [注释编码含义](#注释编码含义)
        - [注释对输入数据的限制](#注释对输入数据的限制)
        - [注释“位标志”](#注释位标志)
        - [将于变量有关的注释通过变量名关联起来](#将于变量有关的注释通过变量名关联起来)
        - [注释全局变量](#注释全局变量)
    - [注释控制结构](#注释控制结构)
        - [应在每个if、case、循环或者代码段前面加上注释](#应在每个ifcase循环或者代码段前面加上注释)
        - [应在每个控制结构后加上注释](#应在每个控制结构后加上注释)

<!-- /TOC -->

---

## 注释的层次：

注释所在的层次：

- 程序
- 文件
- 子程序
- 单独行

位置不同，有若干种不同的注释技术。


---

## 注释单行

对于好的代码，很少需要注释单条语句。

要注释一行代码，有2种可能：

- 该行代码太复杂，因而需要解释
- 该行语句出过错，你想记下这个错

### 单行注释的指导原则：

#### 不要随意添加无关注释

### 行尾注释及其问题：

行尾注释的坏处：

- 没整齐排布话，会影响代码的视觉结构
- 位置少，行尾注释维护起来困难
- 为了写得少，容易含糊不清



#### 不要对单行代码做行尾注释
行尾注释的**系统性问题**是，难以对每行代码都写一句**有意义的注释**。

#### 不要对多行代码做行尾注释

![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho6juskq7j30tg04wwgc.jpg)

用**行尾注释**对多行代码进行说明，其格式将很难说明它究竟**应用于哪几行代码**。

### 何时该用行尾注释：

- 行尾注释用于**数据说明**
![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho6mk3rhaj30w603q3zv.jpg)

- 避免用行尾注释存在**维护标记**
 - 注释应该解释代码为什么
![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho6ngqd3qj30sg02g74h.jpg)

 

- 用行尾注释**标记块尾**
 - 用行尾注释标记大的代码块的结束位置是很合适的。

除了上面三种情况，行尾注释有着概念性的问题，而且常常用于很复杂的代码，带来编排和维护困难。

总之，**最好不要用行尾注释**。


---

## 注释代码段


### 注释应表达代码的意图

- 好的例子：
![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho6um2ugdj30gc050q3v.jpg)

- 坏的例子：

![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho6ud6uhvj30oy0ek42x.jpg)

- 在意图层写注释的方法：
 - 想象如果这段代码换成同样功能的子程序，会怎样命名它。



### 代码本身应尽力做好说明

- 好的例子：

![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho6xkcqu5j31fg0f0qcg.jpg)

### 注释代码时，应注重why而不是how

说明how的注释一般停留在**编程语言的层次**，而不是为了说明问题。

- 例子：

![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho70w65vaj30s6092dir.jpg)

### 用注释为后面的内容做铺垫

好的注释会告诉读者后面有什么内容。
读者只要浏览注释就能够了解代码在做什么，到哪去找特定的操作。

### 让每个注释都有用

过度注释不是优点——太多的注释只会把其要阐明的代码搞得含混不清。

与其写更多注释，还不如对代码本身的可读性下功夫。

### 说明非常规做法

![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho753zoi8j30ra0680uu.jpg)

为了节约性能、时间写的非常规代码，记得加上注释。

### 别用缩略语
注释不应有歧义，应当易读而无须猜测缩写为何意。


### 将主次注释区分开

有时，你也许想把不同层次的注释区分开，以指明某个细节注释是先前某个注释（概括）的一部分，用多种方式可以做到这一点。

- 坏的例子：

![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho799b82xj30xe09iadm.jpg)

- 好的例子：
 - 在**次注释**前面加入省略号，主注释以普通方式编排

![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho7aecsauj30xe08on05.jpg)


最好的办法；

将主注释所述的操作独立为子程序。
**子程序逻辑**上应是“扁平的”，其所有行为都在**同一个逻辑层次**。

如果子程序区分**主行为**和**次行为**，该子程序就不是扁平的。

通过将复杂行为打包放进各自的子程序，可以使其成为两个逻辑上平时的子程序，而不是一个逻辑上跌宕起伏的子程序。


### 错误或语言环境独特点都要加注释

- 例子：
 - 仅当blockSize为500时，才会表现出某种缺陷
  
![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho8w4rbirj30os0bsjv6.jpg)

### 给出违背良好编程风格的理由

如果你不得不违背良好的编程风格，要解释其原因。


### 不要注释投机取巧的代码，应重写之。

- 例子：
 - 说明特别“技巧性的”或“敏感的”代码部分

![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho8yquesmj30rk04gwg8.jpg)



对投机取巧的代码注释是错误的。
注释不应帮扶难度大的代码。

**不要注释糟糕的代码——应重写之**(1978)

---

## 注释数据声明


变量声明的注释应给出变量名**未表达出来的各种信息**。

对**数据注释**比对使用数据的过程做注释更重要(1982)

### 注释数值单位

表明单位：

- 长度
 - 英寸
 - 英尺
 - 千米

- 时间 
 - 1980年1月1日到现在的秒数
 - 程序启动后到此时刻的毫秒数

 
### 对数值的允许范围给出注释

如果数值有一个期望范围，就该说明这个范围。


### 注释编码含义

如果变量表示电流类型，应当注释说明：

- 1代表交流电
- 2代表直流电
- 3是未确定

例子：

![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho95grl0cj30su0a0gpg.jpg)

### 注释对输入数据的限制

注释是说明某子程序**不愿接收某些数据**的一些方法。

而ASSERT是另一种说明有效范围的方法，采用这种方法更能让代码有**自检能力**。

### 注释“位标志”

若变量用作位域，就应该对每个数据位的含义做出说明。

- 例子：

![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho99gs387j30rs08kjuk.jpg)


### 将于变量有关的注释通过变量名关联起来

将变量名放在注释中，在修改时，通过字符串查找，就能在搜索变量名时，联通找出含变量名的注释，进行**一致性修改**。


### 注释全局变量

如果使用了全局数据，要在此**声明处**做出注释。

注释要指出：

- 该数据的目的
- 为何必须是全局数据

在使用此数据的每一处，都突出它是全局数据。

好的命名规范是**凸显变量全局性**的首选办法。
如果欠缺这样的规范，则可以用注释代劳。

---

## 注释控制结构

- 判断语句
 - 为什么要进行判断的理由
 - 执行结果的一个总结

- 循环结构
 - 循环的目的是什么

- 例子：

![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho9i2p1cqj30xc0f60yr.jpg)

### 应在每个if、case、循环或者代码段前面加上注释

注释起到**阐明**控制结构的**意图**。   

### 应在每个控制结构后加上注释

长循环或者嵌套循环结尾处的注释尤其有用。

- 例子：
 - 注释指明循环结构的结束位置

![](https://raw.githubusercontent.com/jerrychan807/imggg/master/006tKfTcgy1fho9jdfh9dj30wu07awgr.jpg)




