# 7.1 创建子程序的正当理由

# 1.降低复杂度
创建子程序的**最重要的原因**：

- **降低程序的复杂度**
 - 通过创建子程序来**隐藏**一些信息，这样你就不必要再去考虑这些信息了。 
 - 写完子程序后，直接调用该子程序而无须了解其**内部工作细节**

其他原因：

- 缩小代码规模
- 改善可维护性
- 提高正确性


**如果没有子程序的抽象能力，我们的智力将根本无法管理复杂的程序** 

当**内部循环或条件判断的嵌套层次很深时**，就意味着需要从子程序中提取出新的子程序了。

把**嵌套的部分**提取出来形成一个独立的子程序，可以降低外围子程序的复杂度。

---

# 2.引入中间、易懂的抽象
**把一段代码放入一个命名恰当的子程序内，是说明这段代码用意最好的方法之一。**

与读下面这一串相比：
![](https://ws1.sinaimg.cn/large/006tNc79gy1fhl6zfrm12j30e806iwey.jpg)

阅读下面这条语句就更容易了：

`leafName = GetLeafName(node)`

**这段新程序如此之短，只要给它取个好的名字就足够说明它的用意了。**

与上面的多行代码相比，这个名字提供了**更高层次的抽象**，从而使代码更具**可读性**，也更容易**理解**，同时也**降低**了原来包含着上面那段代码的子程序的**复杂度**。

## 启发&感悟：

> 之前自己限于某种语言的语法的学习当中，写的很多程序都是demo程序，纯粹是为了所谓的实践一下当前的语法特性，更不用说有什么别的好的程序设计思想在里面了。
> 
> 大二写C语言程序实训的时候，实现同样的功能的前提下，自己的程序大概是1500多行，相比同学的程序竟然多了500行。
> 
> 最令我印象深刻的是，我为了实现一个功能，就重写一个函数，而他只是简单的往原有的函数引入一个新的参数，然后再加一些条件判断，就达到了和我同样的功能。
> 几天下来，他的程序简洁、花时少，而我的程序又长又臭。。要不是没有notepad++那个类似标签可以不看函数细节的功能，我想我早写晕了。
> 
> 当时我就觉得自己不是写程序的料。。。
> 
> 慢慢到后来，有写过一些比较多行的程序，才发现自己在**抽象化、模块化**这些思想上，需要恶补很多知识。。



---

# 3.避免代码重复

创建子程序最普遍的原因是为了**避免代码重复**。

事实上，如果在两段子程序内编写相似的代码，就意味着**代码分解(decomposition)**出现了差错。

## 方法1：
将两段子程序中的**重复代码**提取出来，将其中的相同的部分放入一个**基类**，然后再把两段程序中的差异代码放入**派生类**中。

## 方法2：

把相同的代码放入新的子程序中，再让其余的代码来调用这个子程序。

## 无重复的好处：

- 节约空间
- 方便改动
- 便于验证

---

# 4.支持子类别(subclassing)
**覆盖(override)**简短而规整的子程序所需新代码的数量，要比覆盖冗长的子程序更少。

---

# 5.隐藏顺序

把有些代码所必需执行的顺序隐藏起来，比让它们在系统内散布要好很多。

---

# 6.隐藏指针操作
指针操作的可读性通常都很差，而且也容易出错。

通过把这些操作隔离在子程序内部，你就可以把精力集中于**操作的意图本身**，而不是指针**操作机制的细节**。

---

# 7.提高可移植性

可以用子程序来隔离程序中不可移植的部分，从而明确识别和隔离未来的移植工作。

不可移植的部分：

- 编程语言所提供的非标准功能
- 对硬件的依赖
- 对操作系统的依赖

---

# 8.简化复杂的布尔操作

为了理解**程序的流程**，通常没有必要去研究那些复杂的布尔**判断的细节**。

应该把这些判断放入函数中，以提高代码的**可读性**。

好处：

- 把判断的细节放到一边了
- 一个具有**描述性的函数名字**可以概括出判断的目的了

把布尔判断的逻辑放入单独的函数中，也强调了它的重要性。
这样做也会激励人们在函数内部做出更多的努力，提高判断代码的可读性。

---

# 9.改善性能 

- 可以只在一个地方优化代码
- 便于查出哪些代码效率低下
- 一处优化，多处受益

---

# 10.确保所有的子程序都很小
事实上，有些事情写一个大的子程序来完成还会更好。

---

# 例子：似乎没有必要写成子程序的操作

编写有效的子程序时，一个最大的心理障碍是不情愿**为一个简单的目的**而编写一个简单子程序。

But，一个很好而又小巧的子程序会很有用。


在一个程序的十几行代码处写了：
![](https://ws2.sinaimg.cn/large/006tKfTcgy1fhlqeyj1u9j30uw02cgme.jpg)

创建了子程序，并起了个好的名字：

![](https://ws4.sinaimg.cn/large/006tKfTcgy1fhlql2tdp1j30tm04oq4r.jpg)

取代原有的代码：
![](https://ws1.sinaimg.cn/large/006tKfTcgy1fhlqlua2iij30lg022jrw.jpg)
这行代码更具可读性——甚至达到**自我注解**的地步。

发现了要考虑bad data 的情况，要在原有的子程序加上3行：

![](https://ws2.sinaimg.cn/large/006tKfTcgy1fhlqn3dpudj30u2092adn.jpg)

如果还是像原来那样写，总共需要增加几十行代码。

---


# 总结：创建子程序的理由


- 降低复杂度
- 引入中间、易懂的抽象
- 避免代码重复
- 支持子类别(subclassing)
- 隐藏顺序
- 隐藏指针操作
- 提高可移植性
- 简化复杂的布尔操作
- 改善性能

除此之外，创建类的很多理由也适用于它：

- 隔离复杂度
- 隐藏实现细节
- 限制变化所带来的影响
- 隐藏全局数据
- 形成中央控制点
- 促成可重用的代码
- 达到特定的重构的目的


